@using Umbraco.Extensions
@using System.Web
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@{
    var currentPage = Model;
    var breadcrumbs = new List<object>();
    var baseUrl = $"{ViewContext.HttpContext.Request.Scheme}://{ViewContext.HttpContext.Request.Host}";
    
    // Build breadcrumb trail
    var ancestors = currentPage.Ancestors().Reverse().ToList();
    var home = currentPage.Root();
    
    // Add home page
    if (home != null)
    {
        breadcrumbs.Add(new {
            Name = home.Name,
            Url = home.Url(),
            IsLast = false
        });
    }
    
    // Add ancestor pages
    foreach (var ancestor in ancestors.Where(x => x.Id != home?.Id))
    {
        breadcrumbs.Add(new {
            Name = ancestor.Name,
            Url = ancestor.Url(),
            IsLast = false
        });
    }
    
    // Add current page
    if (currentPage.Id != home?.Id)
    {
        breadcrumbs.Add(new {
            Name = currentPage.Name,
            Url = currentPage.Url(),
            IsLast = true
        });
    }
}

@if (breadcrumbs.Count > 1)
{
    <nav class="breadcrumb-nav bg-cream-alt" aria-label="Breadcrumb">
        <div class="container">
            @* Schema.org BreadcrumbList structured data *@
            <script type="application/ld+json">
            {
                "@@context": "https://schema.org",
                "@@type": "BreadcrumbList",
                "itemListElement": [
                    @for (int i = 0; i < breadcrumbs.Count; i++)
                    {
                        var item = breadcrumbs[i];
                        <text>
                        {
                            "@@type": "ListItem",
                            "position": @(i + 1),
                            "name": "@Html.Raw(HttpUtility.JavaScriptStringEncode(((dynamic)item).Name))",
                            "item": "@(baseUrl)@(((dynamic)item).Url)"
                        }@(i < breadcrumbs.Count - 1 ? "," : "")
                        </text>
                    }
                ]
            }
            </script>
            
            <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
                @for (int i = 0; i < breadcrumbs.Count; i++)
                {
                    var item = (dynamic)breadcrumbs[i];
                    <li class="breadcrumb-item @(item.IsLast ? "active" : "")" 
                        itemprop="itemListElement" 
                        itemscope 
                        itemtype="https://schema.org/ListItem">
                        
                        @if (!item.IsLast)
                        {
                            <a href="@item.Url" 
                               itemprop="item"
                               class="breadcrumb-link font-weight-lighter text-brown text-underline text-uppercase">
                                <span itemprop="name">@item.Name</span>
                            </a>
                            <meta itemprop="position" content="@(i + 1)" />
                        }
                        else
                        {
                            <span itemprop="name" class="breadcrumb-current text-brown text-uppercase font-weight-black" aria-current="page">@item.Name</span>
                            <meta itemprop="position" content="@(i + 1)" />
                        }
                    </li>
                }
            </ol>
        </div>
    </nav>
}
